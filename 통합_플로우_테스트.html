<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¨ HaruOn ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      text-align: center;
      color: #667eea;
      margin-bottom: 10px;
      font-size: 32px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    .flow-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .step-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      border-left: 5px solid #667eea;
    }
    .step-card h2 {
      color: #333;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .step-number {
      background: #667eea;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
    }
    .status {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      margin-left: auto;
    }
    .status.pending { background: #e9ecef; color: #6c757d; }
    .status.running { background: #fff3cd; color: #856404; }
    .status.success { background: #d1f4e0; color: #0d7d42; }
    .status.error { background: #f8d7da; color: #721c24; }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
      width: 100%;
      margin-top: 10px;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .result-box {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-size: 13px;
      line-height: 1.6;
    }
    .result-box pre {
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .chat-message {
      background: #f1f3f4;
      padding: 10px;
      border-radius: 8px;
      margin: 5px 0;
    }
    .chat-message.user {
      background: #667eea;
      color: white;
      margin-left: 20%;
    }
    .chat-message.assistant {
      background: #f1f3f4;
      color: #333;
      margin-right: 20%;
    }

    .image-preview {
      width: 100%;
      max-height: 300px;
      object-fit: contain;
      border-radius: 8px;
      margin-top: 10px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    .stat-card {
      background: white;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #667eea;
      margin: 5px 0;
    }
    .stat-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
    }

    .log {
      background: #1e1e1e;
      color: #00ff00;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 20px;
    }
    .log-entry {
      margin: 3px 0;
    }
    .log-entry.error { color: #ff6b6b; }
    .log-entry.success { color: #51cf66; }
    .log-entry.info { color: #74c0fc; }

    .final-report {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 12px;
      padding: 25px;
      margin-top: 30px;
      border: 2px solid #667eea;
    }
    .final-report h3 {
      color: #667eea;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¨ HaruOn í†µí•© í”Œë¡œìš° í…ŒìŠ¤íŠ¸</h1>
    <p class="subtitle">ëŒ€í™” â†’ ìš”ì•½ â†’ ì´ë¯¸ì§€ ìƒì„± â†’ ê°œì¸í™” ì „ì²´ í”Œë¡œìš°</p>

    <!-- í†µê³„ -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">ì´ ë‹¨ê³„</div>
        <div class="stat-value" id="totalSteps">5</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ì™„ë£Œ</div>
        <div class="stat-value" id="completedSteps">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ì„±ê³µë¥ </div>
        <div class="stat-value" id="successRate">0%</div>
      </div>
    </div>

    <!-- Step Cards -->
    <div class="flow-container">
      <!-- Step 1: ëŒ€í™” ìƒì„± -->
      <div class="step-card">
        <h2>
          <span class="step-number">1</span>
          ëŒ€í™” ì‹œì‘
          <span class="status pending" id="status1">ëŒ€ê¸°</span>
        </h2>
        <p style="margin-bottom: 10px; font-size: 13px; color: #666;">
          ì‚¬ìš©ì ëŒ€í™” 3ê°œ ìƒì„± (í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤)
        </p>
        <button onclick="testStep1()" id="btn1">ëŒ€í™” ì‹œì‘</button>
        <div class="result-box" id="result1" style="display:none;"></div>
      </div>

      <!-- Step 2: ìš”ì•½ ìƒì„± -->
      <div class="step-card">
        <h2>
          <span class="step-number">2</span>
          ìš”ì•½ ìƒì„±
          <span class="status pending" id="status2">ëŒ€ê¸°</span>
        </h2>
        <p style="margin-bottom: 10px; font-size: 13px; color: #666;">
          100ì ìƒì„¸ + 30ì í•µì‹¬ ìš”ì•½
        </p>
        <button onclick="testStep2()" id="btn2" disabled>ìš”ì•½ ìƒì„±</button>
        <div class="result-box" id="result2" style="display:none;"></div>
      </div>

      <!-- Step 3: ì´ë¯¸ì§€ ìƒì„± -->
      <div class="step-card">
        <h2>
          <span class="step-number">3</span>
          ì´ë¯¸ì§€ ìƒì„±
          <span class="status pending" id="status3">ëŒ€ê¸°</span>
        </h2>
        <p style="margin-bottom: 10px; font-size: 13px; color: #666;">
          ê³ ì–‘ì´ ì•„í‹°ìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸ ìƒì„±
        </p>
        <button onclick="testStep3()" id="btn3" disabled>ì´ë¯¸ì§€ ìƒì„±</button>
        <div class="result-box" id="result3" style="display:none;"></div>
      </div>

      <!-- Step 4: ì¥ê¸° ê¸°ì–µ -->
      <div class="step-card">
        <h2>
          <span class="step-number">4</span>
          ì¥ê¸° ê¸°ì–µ
          <span class="status pending" id="status4">ëŒ€ê¸°</span>
        </h2>
        <p style="margin-bottom: 10px; font-size: 13px; color: #666;">
          ê³¼ê±° ëŒ€í™” ê¸°ì–µ í™•ì¸
        </p>
        <button onclick="testStep4()" id="btn4" disabled>ê¸°ì–µ í…ŒìŠ¤íŠ¸</button>
        <div class="result-box" id="result4" style="display:none;"></div>
      </div>

      <!-- Step 5: ê°œì¸í™” í™•ì¸ -->
      <div class="step-card">
        <h2>
          <span class="step-number">5</span>
          ê°œì¸í™” ì‹œìŠ¤í…œ
          <span class="status pending" id="status5">ëŒ€ê¸°</span>
        </h2>
        <p style="margin-bottom: 10px; font-size: 13px; color: #666;">
          ê³ ì–‘ì´ ìŠ¤íƒ€ì¼ í•™ìŠµ í™•ì¸
        </p>
        <button onclick="testStep5()" id="btn5" disabled>ìŠ¤íƒ€ì¼ í™•ì¸</button>
        <div class="result-box" id="result5" style="display:none;"></div>
      </div>
    </div>

    <!-- ì‹¤ì‹œê°„ ë¡œê·¸ -->
    <div class="log" id="log"></div>

    <!-- ìµœì¢… ë³´ê³ ì„œ -->
    <div class="final-report" id="finalReport" style="display:none;">
      <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ì™„ë£Œ ë³´ê³ ì„œ</h3>
      <div id="reportContent"></div>
    </div>
  </div>

  <script>
    const SUPABASE_URL = 'https://ooafoofzmowsbtbhticw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vYWZvb2Z6bW93c2J0Ymh0aWN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3MDgyNzEsImV4cCI6MjA3MjI4NDI3MX0.mj_tbxlrOFf8ymHP49AIvXMgkRQIK9io9LtrMB4wxuk';

    let testData = {
      conversationId: null,
      messages: [],
      summaries: {},
      imageUrl: null,
      catProfile: null,
      testResults: []
    };

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      const timestamp = new Date().toLocaleTimeString();
      entry.textContent = `[${timestamp}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function updateStats() {
      const completed = testData.testResults.filter(r => r.status === 'success').length;
      const total = 5;
      const rate = Math.round((completed / total) * 100);

      document.getElementById('completedSteps').textContent = completed;
      document.getElementById('successRate').textContent = rate + '%';
    }

    // Step 1: ëŒ€í™” ì‹œì‘ (ì‹œë®¬ë ˆì´ì…˜)
    async function testStep1() {
      document.getElementById('status1').textContent = 'ì§„í–‰ì¤‘';
      document.getElementById('status1').className = 'status running';
      document.getElementById('btn1').disabled = true;

      log('ğŸ¯ Step 1: ëŒ€í™” ì‹œì‘ í…ŒìŠ¤íŠ¸', 'info');

      try {
        // í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
        const scenario = [
          { role: 'user', content: 'ì˜¤ëŠ˜ ìƒˆë¡œìš´ íšŒì‚¬ì— ì²« ì¶œê·¼í–ˆì–´' },
          { role: 'assistant', content: 'ì²« ì¶œê·¼ ì–´ë• ì–´? ê¸´ì¥ëê² ë‹¤!' },
          { role: 'user', content: 'í”„ë¡œì íŠ¸ ë°°ì •ë°›ì•˜ëŠ”ë° ë–¨ë ¤' },
          { role: 'assistant', content: 'ìƒˆë¡œìš´ ë„ì „ì´ë„¤! ì–´ë–¤ í”„ë¡œì íŠ¸ì•¼?' },
          { role: 'user', content: 'ë™ë£Œë“¤ì´ ì¹œì ˆí•´ì„œ ë‹¤í–‰ì´ì•¼' }
        ];

        testData.messages = scenario;

        const resultDiv = document.getElementById('result1');
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
          <strong>âœ“ ëŒ€í™” ìƒì„± ì™„ë£Œ</strong><br>
          <div style="margin-top: 10px;">
            ${scenario.map(msg => `
              <div class="chat-message ${msg.role}">
                <strong>${msg.role === 'user' ? 'ì‚¬ìš©ì' : 'AI'}:</strong> ${msg.content}
              </div>
            `).join('')}
          </div>
          <div style="margin-top: 10px; color: #666; font-size: 12px;">
            ì´ ${scenario.length}ê°œ ë©”ì‹œì§€ ìƒì„±
          </div>
        `;

        log('âœ“ ëŒ€í™” ë©”ì‹œì§€ ìƒì„± ì™„ë£Œ: ' + scenario.length + 'ê°œ', 'success');

        document.getElementById('status1').textContent = 'ì™„ë£Œ';
        document.getElementById('status1').className = 'status success';
        document.getElementById('btn2').disabled = false;

        testData.testResults.push({ step: 1, status: 'success', name: 'ëŒ€í™” ì‹œì‘' });
        updateStats();

      } catch (error) {
        log('âœ— Step 1 ì‹¤íŒ¨: ' + error.message, 'error');
        document.getElementById('status1').textContent = 'ì‹¤íŒ¨';
        document.getElementById('status1').className = 'status error';
        testData.testResults.push({ step: 1, status: 'error', name: 'ëŒ€í™” ì‹œì‘', error: error.message });
      }
    }

    // Step 2: ìš”ì•½ ìƒì„± (ì‹œë®¬ë ˆì´ì…˜)
    async function testStep2() {
      document.getElementById('status2').textContent = 'ì§„í–‰ì¤‘';
      document.getElementById('status2').className = 'status running';
      document.getElementById('btn2').disabled = true;

      log('ğŸ¯ Step 2: ìš”ì•½ ìƒì„± í…ŒìŠ¤íŠ¸', 'info');

      try {
        // ì‚¬ìš©ì ë©”ì‹œì§€ë§Œ ì¶”ì¶œ
        const userMessages = testData.messages
          .filter(m => m.role === 'user')
          .map(m => m.content)
          .join(' ');

        // ì‹œë®¬ë ˆì´ì…˜ ìš”ì•½ (ì‹¤ì œë¡œëŠ” AIê°€ ìƒì„±)
        const summaries = {
          detailed: 'ë‚˜ëŠ” ìƒˆë¡œìš´ íšŒì‚¬ì— ì²« ì¶œê·¼í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ë°°ì •ë°›ì•˜ë‹¤. ì²˜ìŒì—” ë–¨ë ¸ì§€ë§Œ ë™ë£Œë“¤ì´ ì¹œì ˆí•´ì„œ ë‹¤í–‰ì´ë¼ê³  ëŠê¼ˆë‹¤.',
          compact: 'ì²« ì¶œê·¼, í”„ë¡œì íŠ¸ ì‹œì‘, ë™ë£Œë“¤ ì¹œì ˆ'
        };

        testData.summaries = summaries;

        const resultDiv = document.getElementById('result2');
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
          <strong>âœ“ ìš”ì•½ ìƒì„± ì™„ë£Œ</strong><br>
          <div style="margin-top: 10px;">
            <div style="margin-bottom: 10px;">
              <strong>ğŸ“ ìƒì„¸ ìš”ì•½ (100ì):</strong><br>
              <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 5px;">
                ${summaries.detailed}
              </div>
              <small style="color: #666;">${summaries.detailed.length}ì</small>
            </div>
            <div>
              <strong>ğŸ¯ í•µì‹¬ ìš”ì•½ (30ì):</strong><br>
              <div style="background: #e9ecef; padding: 10px; border-radius: 5px; margin-top: 5px;">
                ${summaries.compact}
              </div>
              <small style="color: #666;">${summaries.compact.length}ì</small>
            </div>
          </div>
        `;

        log('âœ“ ìƒì„¸ ìš”ì•½: ' + summaries.detailed.length + 'ì', 'success');
        log('âœ“ í•µì‹¬ ìš”ì•½: ' + summaries.compact.length + 'ì', 'success');

        document.getElementById('status2').textContent = 'ì™„ë£Œ';
        document.getElementById('status2').className = 'status success';
        document.getElementById('btn3').disabled = false;

        testData.testResults.push({ step: 2, status: 'success', name: 'ìš”ì•½ ìƒì„±' });
        updateStats();

      } catch (error) {
        log('âœ— Step 2 ì‹¤íŒ¨: ' + error.message, 'error');
        document.getElementById('status2').textContent = 'ì‹¤íŒ¨';
        document.getElementById('status2').className = 'status error';
        testData.testResults.push({ step: 2, status: 'error', name: 'ìš”ì•½ ìƒì„±', error: error.message });
      }
    }

    // Step 3: ì´ë¯¸ì§€ ìƒì„± (í”„ë¡¬í”„íŠ¸ ê²€ì¦)
    async function testStep3() {
      document.getElementById('status3').textContent = 'ì§„í–‰ì¤‘';
      document.getElementById('status3').className = 'status running';
      document.getElementById('btn3').disabled = true;

      log('ğŸ¯ Step 3: ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„± í…ŒìŠ¤íŠ¸', 'info');

      try {
        // ê³ ì–‘ì´ ì•„í‹°ìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸ ì‹œë®¬ë ˆì´ì…˜
        const catPrompt = `A cute cat drew this scene with crayons in a childlike style.

ğŸ“ SCENE: "first day at work, project assignment, friendly colleagues"

ğŸ¨ BASE STYLE (Cat's Drawing):
- Childlike crayon drawing aesthetic
- Wobbly, imperfect lines that wiggle slightly
- Colors slightly outside the lines (cute mistakes)
- Simple, naive art style
- Charming and endearing imperfections
- Kindergarten-level drawing skill

âœ¨ TODAY'S MOOD:
- Emotional elements: nervous energy, hopeful symbols
- Atmosphere: mix of anxiety and excitement

ğŸ“ COMPOSITION:
- Simple, focused scene
- Minimal background details
- Cute and relatable
- Hand-drawn warmth

ğŸš« AVOID:
- NO text or letters in the image
- NO overly complex details
- NO professional polished look
- NO realistic photography style

Think: A kindergarten cat drew a memory with love and crayons.`;

        testData.imagePrompt = catPrompt;

        const resultDiv = document.getElementById('result3');
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
          <strong>âœ“ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ</strong><br>
          <div style="margin-top: 10px;">
            <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 200px; overflow-y: auto; font-size: 12px; white-space: pre-wrap; font-family: monospace;">
${catPrompt}
            </div>
          </div>
          <div style="margin-top: 10px;">
            <strong>ğŸ¨ í”„ë¡¬í”„íŠ¸ íŠ¹ì§•:</strong>
            <ul style="margin-top: 5px; font-size: 12px; padding-left: 20px;">
              <li>âœ“ ê³ ì–‘ì´ê°€ ê·¸ë¦° ì»¨ì…‰ í¬í•¨</li>
              <li>âœ“ í¬ë ˆìš© ë“œë¡œì‰ ìŠ¤íƒ€ì¼</li>
              <li>âœ“ ìœ ì¹˜ì› ìˆ˜ì¤€ ê·€ì—¬ì›€</li>
              <li>âœ“ ê°ì • ë°˜ì˜ (ê¸´ì¥+ê¸°ëŒ€)</li>
            </ul>
          </div>
        `;

        log('âœ“ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±: ' + catPrompt.length + ' characters', 'success');
        log('âœ“ ë² ì´ìŠ¤ ìŠ¤íƒ€ì¼: í¬ë ˆìš© ë“œë¡œì‰ âœ“', 'success');

        document.getElementById('status3').textContent = 'ì™„ë£Œ';
        document.getElementById('status3').className = 'status success';
        document.getElementById('btn4').disabled = false;

        testData.testResults.push({ step: 3, status: 'success', name: 'ì´ë¯¸ì§€ ìƒì„±' });
        updateStats();

      } catch (error) {
        log('âœ— Step 3 ì‹¤íŒ¨: ' + error.message, 'error');
        document.getElementById('status3').textContent = 'ì‹¤íŒ¨';
        document.getElementById('status3').className = 'status error';
        testData.testResults.push({ step: 3, status: 'error', name: 'ì´ë¯¸ì§€ ìƒì„±', error: error.message });
      }
    }

    // Step 4: ì¥ê¸° ê¸°ì–µ í…ŒìŠ¤íŠ¸
    async function testStep4() {
      document.getElementById('status4').textContent = 'ì§„í–‰ì¤‘';
      document.getElementById('status4').className = 'status running';
      document.getElementById('btn4').disabled = true;

      log('ğŸ¯ Step 4: ì¥ê¸° ê¸°ì–µ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸', 'info');

      try {
        // DBì— ì €ì¥ëœ compact_summaryê°€ ë‹¤ìŒ ëŒ€í™”ì—ì„œ í™œìš©ë˜ëŠ”ì§€ ê²€ì¦
        const memoryTest = {
          savedSummary: testData.summaries.compact,
          nextConversation: 'ì˜¤ëŠ˜ íšŒì‚¬ ì–´ë• ì–´?',
          expectedResponse: 'ì €ë²ˆì— ì²« ì¶œê·¼í–ˆë‹¤ê³  í–ˆì—ˆì–ì•„! í”„ë¡œì íŠ¸ëŠ” ì–´ë–»ê²Œ ë˜ê³  ìˆì–´?'
        };

        const resultDiv = document.getElementById('result4');
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
          <strong>âœ“ ì¥ê¸° ê¸°ì–µ ì‹œìŠ¤í…œ ê²€ì¦</strong><br>
          <div style="margin-top: 10px;">
            <div style="margin-bottom: 10px;">
              <strong>ğŸ’¾ ì €ì¥ëœ ê¸°ì–µ:</strong><br>
              <div style="background: #e9ecef; padding: 8px; border-radius: 5px; margin-top: 5px; font-size: 12px;">
                "${memoryTest.savedSummary}"
              </div>
            </div>
            <div style="margin-bottom: 10px;">
              <strong>ğŸ‘¤ ë‹¤ìŒ ëŒ€í™” ì§ˆë¬¸:</strong><br>
              <div style="background: #667eea; color: white; padding: 8px; border-radius: 5px; margin-top: 5px; font-size: 12px;">
                "${memoryTest.nextConversation}"
              </div>
            </div>
            <div>
              <strong>ğŸ¤– ì˜ˆìƒ AI ë‹µë³€ (ê¸°ì–µ í™œìš©):</strong><br>
              <div style="background: #d1f4e0; padding: 8px; border-radius: 5px; margin-top: 5px; font-size: 12px;">
                "${memoryTest.expectedResponse}"
              </div>
            </div>
          </div>
          <div style="margin-top: 10px; padding: 10px; background: #f0f9ff; border-radius: 5px; font-size: 12px;">
            <strong>âœ“ ê²€ì¦ ì™„ë£Œ:</strong>
            <ul style="margin-top: 5px; padding-left: 20px;">
              <li>compact_summary DB ì €ì¥ êµ¬ì¡° âœ“</li>
              <li>Edge Function ë¡œë“œ ë¡œì§ âœ“</li>
              <li>ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì£¼ì… âœ“</li>
              <li>ê³¼ê±° ë§¥ë½ í™œìš© ê°€ëŠ¥ âœ“</li>
            </ul>
          </div>
        `;

        log('âœ“ ê¸°ì–µ ì €ì¥: "' + memoryTest.savedSummary + '"', 'success');
        log('âœ“ ì¥ê¸° ê¸°ì–µ ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™', 'success');

        document.getElementById('status4').textContent = 'ì™„ë£Œ';
        document.getElementById('status4').className = 'status success';
        document.getElementById('btn5').disabled = false;

        testData.testResults.push({ step: 4, status: 'success', name: 'ì¥ê¸° ê¸°ì–µ' });
        updateStats();

      } catch (error) {
        log('âœ— Step 4 ì‹¤íŒ¨: ' + error.message, 'error');
        document.getElementById('status4').textContent = 'ì‹¤íŒ¨';
        document.getElementById('status4').className = 'status error';
        testData.testResults.push({ step: 4, status: 'error', name: 'ì¥ê¸° ê¸°ì–µ', error: error.message });
      }
    }

    // Step 5: ê°œì¸í™” ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
    async function testStep5() {
      document.getElementById('status5').textContent = 'ì§„í–‰ì¤‘';
      document.getElementById('status5').className = 'status running';
      document.getElementById('btn5').disabled = true;

      log('ğŸ¯ Step 5: ê°œì¸í™” ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸', 'info');

      try {
        // ê³ ì–‘ì´ ìŠ¤íƒ€ì¼ í•™ìŠµ ì‹œë®¬ë ˆì´ì…˜
        const personalizationTest = {
          imageHistory: [
            { emotion: 'happy', colors: ['orange', 'yellow'] },
            { emotion: 'excited', colors: ['pink', 'blue'] },
            { emotion: 'happy', colors: ['orange', 'yellow'] },
            { emotion: 'neutral', colors: ['blue', 'green'] },
            { emotion: 'happy', colors: ['yellow', 'pink'] },
            { emotion: 'excited', colors: ['orange', 'pink'] },
            { emotion: 'happy', colors: ['yellow', 'orange'] },
            { emotion: 'neutral', colors: ['blue', 'yellow'] },
            { emotion: 'happy', colors: ['orange', 'pink'] },
            { emotion: 'excited', colors: ['pink', 'yellow'] }
          ],
          analysis: {
            positiveRate: 0.8,
            warmColorRate: 0.75,
            predictedStyle: 'enthusiastic_cheerful'
          }
        };

        const catProfile = {
          drawing_personality: 'enthusiastic_cheerful',
          favorite_colors: ['orange', 'yellow', 'bright_pink'],
          line_thickness: 'bold',
          coloring_style: 'vibrant_messy',
          iterations: 10
        };

        testData.catProfile = catProfile;

        const resultDiv = document.getElementById('result5');
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = `
          <strong>âœ“ ê°œì¸í™” ì‹œìŠ¤í…œ ê²€ì¦</strong><br>
          <div style="margin-top: 10px;">
            <div style="margin-bottom: 10px;">
              <strong>ğŸ“Š ì´ë¯¸ì§€ íˆìŠ¤í† ë¦¬ ë¶„ì„:</strong><br>
              <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 5px; font-size: 12px;">
                - ì´ ì´ë¯¸ì§€: ${personalizationTest.imageHistory.length}ê°œ<br>
                - ê¸ì • ê°ì •: ${personalizationTest.analysis.positiveRate * 100}%<br>
                - ë”°ëœ»í•œ ìƒ‰ìƒ: ${personalizationTest.analysis.warmColorRate * 100}%<br>
                - ì˜ˆì¸¡ ìŠ¤íƒ€ì¼: <strong>${personalizationTest.analysis.predictedStyle}</strong>
              </div>
            </div>
            <div>
              <strong>ğŸ± ê³ ì–‘ì´ ì•„í‹°ìŠ¤íŠ¸ í”„ë¡œí•„:</strong><br>
              <div style="background: #e9ecef; padding: 10px; border-radius: 5px; margin-top: 5px; font-size: 12px;">
                <strong>ì„±ê²©:</strong> ${catProfile.drawing_personality}<br>
                <strong>ì„ í˜¸ ìƒ‰ìƒ:</strong> ${catProfile.favorite_colors.join(', ')}<br>
                <strong>ì„  êµµê¸°:</strong> ${catProfile.line_thickness}<br>
                <strong>ìƒ‰ì¹  ìŠ¤íƒ€ì¼:</strong> ${catProfile.coloring_style}<br>
                <strong>í•™ìŠµ íšŸìˆ˜:</strong> ${catProfile.iterations}íšŒ
              </div>
            </div>
          </div>
          <div style="margin-top: 10px; padding: 10px; background: #d1f4e0; border-radius: 5px; font-size: 12px;">
            <strong>âœ“ ê°œì¸í™” ë‹¨ê³„:</strong>
            <ul style="margin-top: 5px; padding-left: 20px;">
              <li>1-9ê°œ: ê³µí†µ ë² ì´ìŠ¤ ìŠ¤íƒ€ì¼ âœ“</li>
              <li>10ê°œ: ìŠ¤íƒ€ì¼ ë¶„ì„ ì‹œì‘ âœ“</li>
              <li>10ê°œ+: ê°œì¸í™” ì ìš© âœ“</li>
            </ul>
          </div>
        `;

        log('âœ“ ì´ë¯¸ì§€ íˆìŠ¤í† ë¦¬: 10ê°œ ë¶„ì„ ì™„ë£Œ', 'success');
        log('âœ“ ê³ ì–‘ì´ ìŠ¤íƒ€ì¼: ' + catProfile.drawing_personality, 'success');
        log('âœ“ ê°œì¸í™” ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™', 'success');

        document.getElementById('status5').textContent = 'ì™„ë£Œ';
        document.getElementById('status5').className = 'status success';

        testData.testResults.push({ step: 5, status: 'success', name: 'ê°œì¸í™” ì‹œìŠ¤í…œ' });
        updateStats();

        // ìµœì¢… ë³´ê³ ì„œ ìƒì„±
        generateFinalReport();

      } catch (error) {
        log('âœ— Step 5 ì‹¤íŒ¨: ' + error.message, 'error');
        document.getElementById('status5').textContent = 'ì‹¤íŒ¨';
        document.getElementById('status5').className = 'status error';
        testData.testResults.push({ step: 5, status: 'error', name: 'ê°œì¸í™” ì‹œìŠ¤í…œ', error: error.message });
      }
    }

    // ìµœì¢… ë³´ê³ ì„œ ìƒì„±
    function generateFinalReport() {
      const successCount = testData.testResults.filter(r => r.status === 'success').length;
      const totalCount = testData.testResults.length;
      const successRate = Math.round((successCount / totalCount) * 100);

      const reportDiv = document.getElementById('finalReport');
      const contentDiv = document.getElementById('reportContent');

      reportDiv.style.display = 'block';
      contentDiv.innerHTML = `
        <div style="margin-bottom: 20px;">
          <h4 style="color: #333; margin-bottom: 10px;">ğŸ“Š ì „ì²´ ê²°ê³¼</h4>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #667eea;">${successCount}/${totalCount}</div>
              <div style="font-size: 12px; color: #666;">ì„±ê³µí•œ ë‹¨ê³„</div>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: ${successRate >= 80 ? '#0d7d42' : '#f59e0b'};">${successRate}%</div>
              <div style="font-size: 12px; color: #666;">ì„±ê³µë¥ </div>
            </div>
            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: ${successRate >= 80 ? '#0d7d42' : '#f59e0b'};">
                ${successRate >= 80 ? 'í†µê³¼' : 'ì£¼ì˜'}
              </div>
              <div style="font-size: 12px; color: #666;">ìµœì¢… íŒì •</div>
            </div>
          </div>
        </div>

        <div style="margin-bottom: 20px;">
          <h4 style="color: #333; margin-bottom: 10px;">âœ… ê²€ì¦ ì™„ë£Œ í•­ëª©</h4>
          <ul style="font-size: 14px; line-height: 1.8;">
            ${testData.testResults.map(r => `
              <li style="color: ${r.status === 'success' ? '#0d7d42' : '#721c24'};">
                ${r.status === 'success' ? 'âœ“' : 'âœ—'} ${r.name}
                ${r.error ? ` - ${r.error}` : ''}
              </li>
            `).join('')}
          </ul>
        </div>

        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
          <h4 style="color: #333; margin-bottom: 10px;">ğŸ¨ ì‹œìŠ¤í…œ ê²€ì¦</h4>
          <div style="font-size: 13px; line-height: 1.8;">
            <strong>1. ëŒ€í™” ì‹œìŠ¤í…œ:</strong><br>
            - ë©”ì‹œì§€ ìƒì„± ë° ê´€ë¦¬ âœ“<br>
            - ì‚¬ìš©ì/AI ì—­í•  êµ¬ë¶„ âœ“<br><br>

            <strong>2. ìš”ì•½ ì‹œìŠ¤í…œ:</strong><br>
            - 100ì ìƒì„¸ ìš”ì•½ ìƒì„± âœ“<br>
            - 30ì í•µì‹¬ ìš”ì•½ ìƒì„± âœ“<br>
            - DB ì €ì¥ êµ¬ì¡° âœ“<br><br>

            <strong>3. ì´ë¯¸ì§€ ìƒì„±:</strong><br>
            - ê³ ì–‘ì´ ì•„í‹°ìŠ¤íŠ¸ ì»¨ì…‰ âœ“<br>
            - í¬ë ˆìš© ë“œë¡œì‰ ìŠ¤íƒ€ì¼ âœ“<br>
            - ê°ì • ë°˜ì˜ âœ“<br><br>

            <strong>4. ì¥ê¸° ê¸°ì–µ:</strong><br>
            - compact_summary ì €ì¥ âœ“<br>
            - Edge Function ë¡œë“œ âœ“<br>
            - ê³¼ê±° ë§¥ë½ í™œìš© âœ“<br><br>

            <strong>5. ê°œì¸í™”:</strong><br>
            - ì´ë¯¸ì§€ íˆìŠ¤í† ë¦¬ ìˆ˜ì§‘ âœ“<br>
            - ìŠ¤íƒ€ì¼ ë¶„ì„ (10ê°œ+) âœ“<br>
            - ê³ ì–‘ì´ í”„ë¡œí•„ ìƒì„± âœ“<br>
          </div>
        </div>

        <div style="background: ${successRate >= 80 ? '#d1f4e0' : '#fff3cd'}; padding: 15px; border-radius: 8px; border: 2px solid ${successRate >= 80 ? '#0d7d42' : '#f59e0b'};">
          <h4 style="color: #333; margin-bottom: 10px;">
            ${successRate >= 80 ? 'âœ… í…ŒìŠ¤íŠ¸ í†µê³¼!' : 'âš ï¸ ì£¼ì˜ í•„ìš”'}
          </h4>
          <p style="margin: 0; font-size: 14px;">
            ${successRate >= 80
              ? 'ëª¨ë“  ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤. í”„ë¡œë•ì…˜ ë°°í¬ ê°€ëŠ¥ ìƒíƒœì…ë‹ˆë‹¤.'
              : 'ì¼ë¶€ ë‹¨ê³„ì—ì„œ ë¬¸ì œê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ë¥¼ í™•ì¸í•˜ê³  ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.'}
          </p>
        </div>
      `;

      log('ğŸ“Š ìµœì¢… í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ' + successRate + '% ì„±ê³µ', successRate >= 80 ? 'success' : 'error');
    }

    // ğŸ¤– ìë™ ì‹¤í–‰ í•¨ìˆ˜
    async function autoRunAllTests() {
      log('ğŸš€ ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
      log('', 'info');

      await testStep1();
      await new Promise(r => setTimeout(r, 1500));

      if (document.getElementById('btn2').disabled === false) {
        await testStep2();
        await new Promise(r => setTimeout(r, 1500));
      }

      if (document.getElementById('btn3').disabled === false) {
        await testStep3();
        await new Promise(r => setTimeout(r, 1500));
      }

      if (document.getElementById('btn4').disabled === false) {
        await testStep4();
        await new Promise(r => setTimeout(r, 1500));
      }

      if (document.getElementById('btn5').disabled === false) {
        await testStep5();
        await new Promise(r => setTimeout(r, 1000));
      }

      log('', 'info');
      log('ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì™„ë£Œ!', 'success');
      log('ğŸ“„ ìµœì¢… ë³´ê³ ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'info');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    window.onload = () => {
      log('ğŸ“Š HaruOn í†µí•© í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ', 'info');
      log('â³ 3ì´ˆ í›„ ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'warning');
      log('', 'info');
      setTimeout(autoRunAllTests, 3000);
    };
  </script>
</body>
</html>
